<!doctype html>
<html class="no-js" lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>{{ title }}</title>

    <meta name="viewport" content="user-scalable=no, width=device-width">

    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/octicons/octicons.css">
    <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400' rel='stylesheet' type='text/css'>
</head>
<body>

<h1>{{ title }}</h1>

<p>Powered by <a href="https://github.com/xhacker/miracle-board" target="_blank">Miracle Board</a></p>

{% for task in tasks %}
<div class="clearfix">
<p class="status" data-id="{{ task.id }}"><span class="icon mega-octicon octicon-hourglass"></span><span class="text">...</span></p>
<p class="title">{{ task.title }}</p>
</div>
{% endfor %}

<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
<script>!window.jQuery && document.write('<script src="/static/js/jquery-1.10.2.min.js"><\/script>')</script>
<script type="text/javascript">
$(function() {
    var time = {{ auto }}
    function update() {
      $.ajax('/tasks', {timeout: 7000}).done(function(data) {
        data = JSON.parse(data);
        $(".status").each(function() {
            var id = $(this).attr("data-id");
            var elem = $(this);
            var up = data[id]
            elem.find(".icon").removeClass("octicon-hourglass");
            if (up && up == "true") {
                elem.removeClass("down");
                elem.addClass("up");
                elem.find(".icon").removeClass("octicon-x");
                elem.find(".icon").addClass("octicon-check");
                elem.find(".text").text("Up");
            } else {
                elem.removeClass("up");
                elem.addClass("down");
                elem.find(".icon").removeClass("octicon-check");
                elem.find(".icon").addClass("octicon-x");
                elem.find(".text").text("Down");
            }
        });
        if (time && time > 0) {
            setTimeout(update, time);
        }
      }).fail(function() {
        $(".status").each(function() {
          var elem = $(this);
          elem.removeClass("up");
          elem.addClass("down");
          elem.find(".icon").removeClass("octicon-check");
          elem.find(".icon").addClass("octicon-x");
          elem.find(".text").text("Down");
        });
        if (time && time > 0) {
            setTimeout(update, time);
        }
      });
    }
    update();
});
</script>
</footer>

</body>
</html>
